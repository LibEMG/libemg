<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake Game &mdash; libemg 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> libemg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/introduction/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/data/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/filtering/filtering.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/features/features.html">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/feature_selection/feature_selection.html">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/prediction/prediction.html">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/evaluation/evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/animation/animation.html">Animation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/screen_guided_training/sgt.html">Screen Guided Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/supported_hardware/supported_hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/visualization/visualization.html">Visualizations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html">Data Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.datasets">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.filtering">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_extractor">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_selector">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.emg_predictor">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.offline_metrics">Offline Evaluation Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.utils">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.streamers">Streamers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.gui">Screen Guided Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Offline Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../simple_offline_example/simple_offline_example.html">Simple Offline Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features_and_group_example/features_and_group_example.html">Exploring Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_optimization_example/feature_optimization_example.html">Optimizing Feature Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_learning_example/deep_learning_example.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../offline_regression_example/offline_regression_example.html">Offline Regression Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Online Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="snake_example.html">Continuous Control (Snake)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unity_example/unity_example.html">Cross Platform Control (Unity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mouse_example/mouse_example.html">Proportional Control (Mouse Interface)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixed_reality_example/mixed_reality_example.html">Mixed Reality (Hololens 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitts_example/fitts_example.html">Online Evaluation (Iso Fitts)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">libemg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Snake Game</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/libemg/libemg/blob/main/docs/source/examples/snake_example/snake.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
    .container {
        width: 50%;
        float: left;
        padding: 10px;
    }
    .float-container {
        padding: 20px;
        border: 3px solid #fff;
    }
</style>
<p><a class="reference external" href="https://github.com/libemg/LibEMG_Snake_Showcase">View Source Code</a></p>
<section class="tex2jax_ignore mathjax_ignore" id="snake-game">
<h1>Snake Game<a class="headerlink" href="#snake-game" title="Permalink to this heading"></a></h1>
<p>Continuous control is the type of myoelectric control used by amputees to control a prosthesis. In these control schemes, decisions are generated <span class="math notranslate nohighlight">\(N\)</span> times per second and used to micro-adjust a device. This example leverages this type of control for a common HCI application - gaming.</p>
<p>We created an adapted version of the traditional snake game to explore a simple continuous control scheme. This game was implemented using pygame, a simple python game engine. The idea of the game is that the player will collect “food” to grow the snake as big as possible. Each prediction (occurring at <span class="math notranslate nohighlight">\(N\)</span> times per second) moves the snake one unit in that direction.</p>
<div class="float-container">
    <div class="container"> 
        <center><p> <b> <u> Myo </u> </b> </p></center>
        <img src="https://github.com/libemg/LibEMG_Snake_Showcase/blob/main/docs/myo_game.gif?raw=true"/>
    </div>
    <div class="container"> 
    <center><p> <b> <u> Delsys </u> </b> </p></center>
        <img src="https://github.com/libemg/LibEMG_Snake_Showcase/blob/main/docs/delsys.gif?raw=true"/>
    </div>
</div>
<p> ________ </p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="game-design">
<h1>Game Design<a class="headerlink" href="#game-design" title="Permalink to this heading"></a></h1>
<p>This section focuses on the design considerations for interfacing the game with EMG-based input. To explore the game design code, please review <code class="docutils literal notranslate"><span class="pre">snake_game.py</span></code>.</p>
<p>Most game engines (including pygame) update the graphical user interface (GUI) based on a looping system. By setting <code class="docutils literal notranslate"><span class="pre">self.clock.tick(30)</span></code> the screen refresh rate is capped at 30 Hz. As a result, the GUI will update 30 times every second. Interestingly, this has significant consequences for our continuous EMG-based control system. Note that the <code class="docutils literal notranslate"><span class="pre">handle_movement</span></code> function is called in this loop - meaning it is called 30 times a second.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Game loop </span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span> 
        <span class="c1"># Listen for movement events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_movement</span><span class="p">()</span>

        <span class="c1"># Additional game related code... (see snake_game.py)</span>

        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1"># Refresh rate is 30 Hz </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>The first step involved creating a version where the arrow keys moved the snake. Note that we are appending the movement direction to an array to keep track of the previous movement of all parts of the snake. The <code class="docutils literal notranslate"><span class="pre">move_snake</span></code> function moves each part of the snake in the specified direction.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">handle_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span> 
            
        <span class="c1"># Listen for key presses:</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_LEFT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_RIGHT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_UP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_DOWN</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">move_snake</span><span class="p">()</span>
</pre></div>
</div>
<p>Converting the keyboard version to leverage EMG-based control required a simple modification. As LibEMG streams all classification decisions over UDP, we set up a socket listening on the specified port and IP. By default, the OnlineEMGClassifier streams at <code class="docutils literal notranslate"><span class="pre">port:12346</span></code> and <code class="docutils literal notranslate"><span class="pre">ip:'127.0.0.1'</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Socket for reading EMG</span>
<span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span> 
<span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">12346</span><span class="p">))</span>
</pre></div>
</div>
<p>After setting up the socket, moving the snake is almost identical to using key presses. Instead of looking for a specific key press, the predicted class label is mapped to a direction. For example, the mappings from predictions to controls are 0 (Hand Close)-down, 1 (Hand Open)-up, 3 (Wrist Extension)-right, and 4 (Wrist Flexion)-left. Note that the snake only moves when a prediction is made by the EMG Classifier.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">handle_emg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">input_class</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># 0 = Hand Closed = down</span>
        <span class="k">if</span> <span class="n">input_class</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">)</span>
        <span class="c1"># 1 = Hand Open</span>
        <span class="k">elif</span> <span class="n">input_class</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">)</span>
        <span class="c1"># 3 = Extension </span>
        <span class="k">elif</span> <span class="n">input_class</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="c1"># 4 = Flexion</span>
        <span class="k">elif</span> <span class="n">input_class</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_key_presses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">move_snake</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="classification-and-model-training">
<h1>Classification and Model Training<a class="headerlink" href="#classification-and-model-training" title="Permalink to this heading"></a></h1>
<p>Now that we have shown how to leverage EMG predictions to replace traditional key presses for snake control, we need to explore the design of the continuous control system. The first step in any EMG-based control scheme is accumulating training data to train the machine learning model. The accumulation of screen-guided training data is built directly into the game using the Screen Guided Training tool. All code can be found in <code class="docutils literal notranslate"><span class="pre">game_menu.py</span></code>.</p>
<div>
    <img src="https://github.com/libemg/LibEMG_Snake_Showcase/blob/main/docs/menu.PNG?raw=true" width="32%" display="inline-block" float="left"/>
    <img src="https://github.com/libemg/LibEMG_Snake_Showcase/blob/main/docs/training_screen1.PNG?raw=true" width="32%" float="left"/>
    <img src="https://github.com/libemg/LibEMG_Snake_Showcase/blob/main/docs/training_screen2.PNG?raw=true" width="32%" float="left"/>
</div>
<p>First, the required imports from libemg:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">libemg.gui</span><span class="w"> </span><span class="kn">import</span> <span class="n">GUI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.data_handler</span><span class="w"> </span><span class="kn">import</span> <span class="n">OnlineDataHandler</span><span class="p">,</span> <span class="n">OfflineDataHandler</span><span class="p">,</span> <span class="n">RegexFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.streamers</span><span class="w"> </span><span class="kn">import</span> <span class="n">oymotion_streamer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.feature_extractor</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureExtractor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.emg_predictor</span><span class="w"> </span><span class="kn">import</span> <span class="n">OnlineEMGClassifier</span><span class="p">,</span> <span class="n">EMGClassifier</span>
</pre></div>
</div>
<p>To listen for decisions streamed over a port, an OnlineDataHandler is required. This data handler maintains a real-time EMG data buffer and is required for training and classification.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">streamer</span><span class="p">,</span> <span class="n">sm</span> <span class="o">=</span> <span class="n">oymotion_streamer</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">odh</span> <span class="o">=</span> <span class="n">OnlineDataHandler</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</pre></div>
</div>
<p>When the data accumulation button is pressed the training UI menu is presented to the user. Note that using the <a class="reference external" href="https://github.com/libemg/LibEMGGestures">LibEMGGesture library</a>, automatically downloads the images for each class if they do not already exist. After finishing the data accumulation, the simple game menu is re-initialized.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">launch_training</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c1"># Launch training ui</span>
    <span class="n">training_ui</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">gesture_height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gesture_width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">training_ui</span><span class="o">.</span><span class="n">download_gestures</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s2">&quot;images/&quot;</span><span class="p">)</span>
    <span class="n">training_ui</span><span class="o">.</span><span class="n">start_gui</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_ui</span><span class="p">()</span>
</pre></div>
</div>
<p>The game starts when the play button is clicked. However, the first thing to do is spin up an <code class="docutils literal notranslate"><span class="pre">OnlineEMGClassifier</span></code> to make predictions in a separate process that the game can use.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">play_snake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_up_classifier</span><span class="p">()</span>
    <span class="n">SnakeGame</span><span class="p">()</span><span class="o">.</span><span class="n">run_game</span><span class="p">()</span>
    <span class="c1"># Its important to stop the classifier after the game has ended</span>
    <span class="c1"># Otherwise it will continuously run in a seperate process</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">stop_running</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_ui</span><span class="p">()</span>
</pre></div>
</div>
<p>After acquiring the offline training data, creating an online classifier is simple. Step 1 involves parsing the accumulated training data for a particular user. This training data can then be split into <code class="docutils literal notranslate"><span class="pre">train_windows</span></code> and <code class="docutils literal notranslate"><span class="pre">train_metadata</span></code>. The rep values will depend on the number of training reps acquired for each class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Parse offline training data</span>
<span class="n">dataset_folder</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span>
<span class="n">regex_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;C_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_R&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;classes&#39;</span><span class="p">),</span>
    <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;R_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_emg.csv&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;reps&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">offline_dh</span> <span class="o">=</span> <span class="n">OfflineDataHandler</span><span class="p">()</span>
<span class="n">offline_dh</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">folder_location</span><span class="o">=</span><span class="n">dataset_folder</span><span class="p">,</span> <span class="n">regex_filters</span><span class="o">=</span><span class="n">regex_filters</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">train_windows</span><span class="p">,</span> <span class="n">train_metadata</span> <span class="o">=</span> <span class="n">offline_dh</span><span class="o">.</span><span class="n">parse_windows</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">)</span>
</pre></div>
</div>
<p>Step 2 involves extracting features from the train_windows since the online classifier expects these as input. In this example, Hudgins’ Time Domain (HTD) features are extracted, a common grouping used for prosthesis control. However, testing different features or feature groups could be done by changing this line.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 2: Extract features from offline data</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureExtractor</span><span class="p">()</span>
<span class="n">feature_list</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">get_feature_groups</span><span class="p">()[</span><span class="s1">&#39;HTD&#39;</span><span class="p">]</span>
<span class="n">training_features</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">feature_list</span><span class="p">,</span> <span class="n">train_windows</span><span class="p">)</span>
</pre></div>
</div>
<p>Step 3 involves setting up the dataset dictionary that is passed into the classifier.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: Dataset creation</span>
<span class="n">data_set</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">training_features</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_metadata</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Step 4 involves setting up the EMGClassifier for the OnlineClassifier. An LDA model was chosen since it is known to work well and is reliable. Note that other models could be used here if desired.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 4: Create the EMG Classifier</span>
<span class="n">o_classifier</span> <span class="o">=</span> <span class="n">EMGClassifier</span><span class="p">(</span><span class="s2">&quot;LDA&quot;</span><span class="p">)</span>
<span class="n">o_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_dictionary</span><span class="o">=</span><span class="n">data_set</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, in step 5 an online EMG classifier is trained and begins streaming predictions. By default these predictions are streamed at <code class="docutils literal notranslate"><span class="pre">port:12346</span></code> and <code class="docutils literal notranslate"><span class="pre">ip:'127.0.0.1'</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Create online EMG classifier and start classifying.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">OnlineEMGClassifier</span><span class="p">(</span><span class="n">o_classifier</span><span class="p">,</span> <span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># block set to false so it will run in a seperate process.</span>
</pre></div>
</div>
<p>Notice that the online classifier has a window size and window increment option. Since the refresh rate of the game is 30 Hz, the minimum increment in time would be <span class="math notranslate nohighlight">\(\frac{1000\text{ms}}{30hz}=33 \text{ms}\)</span>. Anything less would result in decisions that would not be leveraged by the game. Selecting these values is not trivial and often takes experimentation. While smaller increments result in more responsive systems, this may not be desired. A larger window size may result in more accurate predictions but introduces lag into the system. In this example, we select a window size of 0.5s (100 samples for the Myo) and an increment of 0.25s (50 samples for the Myo). Since we move the snake 20 pixels for every input, the snake moves 80 pixels in a given second (assuming no decisions are rejected).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">100</span> 
<span class="n">WINDOW_INCREMENT</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>