<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mixed Reality (Hololens 2) &mdash; libemg 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Online Evaluation (Iso Fitts)" href="../fitts_example/fitts_example.html" />
    <link rel="prev" title="Proportional Control (Mouse Interface)" href="../mouse_example/mouse_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> libemg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/introduction/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/data/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/filtering/filtering.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/features/features.html">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/feature_selection/feature_selection.html">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/prediction/prediction.html">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/evaluation/evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/animation/animation.html">Animation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/screen_guided_training/sgt.html">Screen Guided Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/supported_hardware/supported_hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/visualization/visualization.html">Visualizations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html">Data Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.datasets">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.filtering">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_extractor">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_selector">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.emg_predictor">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.offline_metrics">Offline Evaluation Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.utils">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.streamers">Streamers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.gui">Screen Guided Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Offline Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../simple_offline_example/simple_offline_example.html">Simple Offline Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features_and_group_example/features_and_group_example.html">Exploring Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_optimization_example/feature_optimization_example.html">Optimizing Feature Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_learning_example/deep_learning_example.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../offline_regression_example/offline_regression_example.html">Offline Regression Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Online Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../snake_example/snake_example.html">Continuous Control (Snake)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unity_example/unity_example.html">Cross Platform Control (Unity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mouse_example/mouse_example.html">Proportional Control (Mouse Interface)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mixed Reality (Hololens 2)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#emg-based-control">EMG-Based Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#controls">Controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-scheme">Control Scheme</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hololens-support">Hololens Support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#menu-controller">Menu Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="#myo-client">Myo Client</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fitts_example/fitts_example.html">Online Evaluation (Iso Fitts)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">libemg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Mixed Reality (Hololens 2)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/libemg/libemg/blob/main/docs/source/examples/mixed_reality_example/mixed_reality_example.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mixed-reality-hololens-2">
<h1>Mixed Reality (Hololens 2)<a class="headerlink" href="#mixed-reality-hololens-2" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="https://github.com/libemg/LibEMG_MixedReality_Showcase">View Source Code</a>
<img alt="" src="../../_images/mr.gif" /></p>
<p>One reason for the renewed interest in EMG as a general-purpose input modality stems from its inherent potential for mixed reality. With the continued advancement of mixed reality technology, myoelectric control may become desirable for several reasons due to its subtlety and convenience. In this example, we show how LibEMG can be leveraged to navigate a menu on the HoloLens 2. While this example is not a robust MR application, it’s the foundation for future work to explore EMG in MR.</p>
<section class="tex2jax_ignore mathjax_ignore" id="emg-based-control">
<h2>EMG-Based Control<a class="headerlink" href="#emg-based-control" title="Permalink to this heading"></a></h2>
<section id="controls">
<h3>Controls<a class="headerlink" href="#controls" title="Permalink to this heading"></a></h3>
<p>The controls used for menu navigation are highlighted below:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Control</p></th>
<th class="head"><p>Contraction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Scroll Up</p></td>
<td><p>Wrist Extension</p></td>
</tr>
<tr class="row-odd"><td><p>Scroll Down</p></td>
<td><p>Wrist Flexion</p></td>
</tr>
<tr class="row-even"><td><p>Open Menu</p></td>
<td><p>Hand Open</p></td>
</tr>
<tr class="row-odd"><td><p>Press Button</p></td>
<td><p>Finger Tap</p></td>
</tr>
<tr class="row-even"><td><p>Do Nothing</p></td>
<td><p>Rest</p></td>
</tr>
</tbody>
</table>
</section>
<section id="control-scheme">
<h3>Control Scheme<a class="headerlink" href="#control-scheme" title="Permalink to this heading"></a></h3>
<p>The file associated with the myoelectric control scheme in this example can be found in <code class="docutils literal notranslate"><span class="pre">emg_control.py</span></code>. The only difference compared to the previous examples is that we stream predictions from the classifier over TCP instead of UDP. We do this because the Hololens has better compatibility for TCP network communication. As shown, we are streaming over the network computer’s IP and through port 8099.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Create online EMG classifier and start classifying.</span>
<span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;x.x.x.x&#39;</span> <span class="c1"># Replace with computer IP</span>
<span class="c1"># IP = &#39;127.0.0.1&#39; # Local host if running in editor</span>
<span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">OnlineEMGClassifier</span><span class="p">(</span><span class="n">o_classifier</span><span class="p">,</span> <span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">IP</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8099</span><span class="p">,</span> <span class="n">tcp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">std_out</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="hololens-support">
<h2>Hololens Support<a class="headerlink" href="#hololens-support" title="Permalink to this heading"></a></h2>
<p>To develop the Hololens portion of the app, we leveraged the <a class="reference external" href="https://learn.microsoft.com/en-us/windows/mixed-reality/mrtk-unity/mrtk2/?view=mrtkunity-2022-05">MRTK</a>, a toolkit to facilitate the development of MR systems on the Hololens. This gave us access to several predefined assets, such as menus and buttons. We created two scripts in this example: <code class="docutils literal notranslate"><span class="pre">MenuController.cs</span></code> and <code class="docutils literal notranslate"><span class="pre">MyoReaderClient.cs</span></code>.</p>
<section id="menu-controller">
<h3>Menu Controller<a class="headerlink" href="#menu-controller" title="Permalink to this heading"></a></h3>
<p>The menu implemented is simply a scrollable view consisting of ten button objects (from the MRTK). To turn the continuous predictions into more discrete events, the menu controller waits for five consecutive decisions before doing anything. Since the window increment is 20 samples and the sampling rate is 200 Hz, each action is at least 0.5s. Therefore, to open the menu, the user will have to keep their hand open for 0.5s. The goal was to reduce spurious false activations and enable the system to recognize discrete actions (e.g., hand open or wrist swipes) rather than continuous contractions.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>void Update() {
    // First check for 5 consecutive actions
    if (emgReader.consecutive == 5) {
        if (emgReader.control == &quot;4&quot;) {
            // Move Up - Flexion
            UpScroll();
        } else if (emgReader.control == &quot;3&quot;) {
            // Move Down - Extension
            DownScroll();
        } else if (emgReader.control == &quot;0&quot;) {
            // Hand close
            ButtonClick();
        } else if (emgReader.control == &quot;1&quot;) {
            // Hand Open - Open.Close Menu
            menu.SetActive(!menu.activeSelf);
        }
        // Updates the button text color based on which is selected
        if (menu.activeSelf) {
            UpdateButtonColors();
        }
        // Reset - This acts as a bit of a debounce.
        emgReader.control = &quot;&quot;;
        emgReader.consecutive = 0;
    }
}
</pre></div>
</div>
</section>
<section id="myo-client">
<h3>Myo Client<a class="headerlink" href="#myo-client" title="Permalink to this heading"></a></h3>
<p>To connect LibEMG to the Hololens, we stream predictions over TCP. When testing the application in the Unity editor, this entails one protocol (localhost), and for streaming to the Hololens it is another. This logic, which is split into the <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">UNITY_EDITOR</span></code> blocks, means the Myo Client script works in both cases. This script should remain relatively consistent if leveraged for a different use-case.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using System.IO;
using UnityEngine.Networking;
using System.Net.Sockets;
using System.Net;
using System.Text;
using System;
using TMPro;

#if !UNITY_EDITOR
using System.Threading.Tasks;
#else
using System.Threading;
#endif

public class MyoReaderClient : MonoBehaviour {

#if !UNITY_EDITOR
    private Windows.Networking.Sockets.StreamSocket socket;
    private Task socketListenTask;
#endif

    # Listen on port 8099
    private int port = 8099;
    private string host = &quot;127.0.0.1&quot;;
    private string ipAddress = &quot;x.x.x.x&quot;; // Replace with computer IP
    private string portUWP = &quot;8099&quot;;
    public string control = &quot;Starting!&quot;;
    public int consecutive = 0; // Used for discrete control in the menucontroller
    private StreamReader reader;
    private bool connected = false;


#if UNITY_EDITOR
    TcpClient socketClient;
#endif

    void Start () {
#if !UNITY_EDITOR
        ConnectSocketUWP();
#else
        ConnectSocketUnity();
        var readThread = new Thread(new ThreadStart(ListenForDataUnity));
        readThread.IsBackground = true;
        readThread.Start();
#endif
    }

    void Update () {
#if !UNITY_EDITOR
        if(socketListenTask == null || socketListenTask.IsCompleted)
        {
            socketListenTask = new Task(async() =&gt;{ListenForDataUWP();});
            socketListenTask.Start();
        }
#endif
    }

#if UNITY_EDITOR
    void ConnectSocketUnity()
    {
        IPAddress ipAddress = IPAddress.Parse(host);

        socketClient = new TcpClient();
        try
        {
            socketClient.Connect(ipAddress, port);
        }

        catch
        {
            Debug.Log(&quot;error when connecting to server socket&quot;);
        }
    }
#else
    private async void ConnectSocketUWP()
    {
        try
        {
            socket = new Windows.Networking.Sockets.StreamSocket();
            Windows.Networking.HostName serverHost = new Windows.Networking.HostName(ipAddress);
            await socket.ConnectAsync(serverHost, portUWP);
            Stream streamIn = socket.InputStream.AsStreamForRead();
            reader = new StreamReader(streamIn, Encoding.UTF8);
            connected = true;
            control = &quot;Connected&quot;;
        }
        catch (Exception e)
        {
            control = &quot;Connection Error&quot;;
        }
    }
#endif

#if UNITY_EDITOR
    void ListenForDataUnity()
    {
        int data;
        while(true){
            byte[] bytes = new byte[socketClient.ReceiveBufferSize];
            NetworkStream stream = socketClient.GetStream();
            data = stream.Read(bytes, 0, socketClient.ReceiveBufferSize);
            string tControl = Encoding.UTF8.GetString(bytes, 0, data).Trim();
            // Keep track of consecutive agreements
            if (tControl == control) {
                consecutive += 1;
            } else {
                consecutive = 0;
            }
            control = tControl;

        }
    }
#else
    private void ListenForDataUWP()
    {
        try {
            // Keep track of consecutive predictions
            string tControl = reader.ReadLine().Trim();
            if (tControl == control) {
                consecutive += 1;
            } else {
                consecutive = 0;
            }
            control = tControl;
        } catch (Exception e) {
            //Do nothing
        }
    }
#endif
}
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../mouse_example/mouse_example.html" class="btn btn-neutral float-left" title="Proportional Control (Mouse Interface)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../fitts_example/fitts_example.html" class="btn btn-neutral float-right" title="Online Evaluation (Iso Fitts)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>