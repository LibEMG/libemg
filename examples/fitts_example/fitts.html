<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Methods &mdash; libemg 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> libemg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/introduction/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/data/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/filtering/filtering.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/features/features.html">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/feature_selection/feature_selection.html">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/prediction/prediction.html">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/evaluation/evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/animation/animation.html">Animation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/screen_guided_training/sgt.html">Screen Guided Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/supported_hardware/supported_hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/visualization/visualization.html">Visualizations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html">Data Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.datasets">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.filtering">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_extractor">Feature Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.feature_selector">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.emg_predictor">EMG Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.offline_metrics">Offline Evaluation Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.utils">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.streamers">Streamers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emg_toolbox.html#module-libemg.gui">Screen Guided Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Offline Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../simple_offline_example/simple_offline_example.html">Simple Offline Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features_and_group_example/features_and_group_example.html">Exploring Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_optimization_example/feature_optimization_example.html">Optimizing Feature Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_learning_example/deep_learning_example.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../offline_regression_example/offline_regression_example.html">Offline Regression Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Online Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../snake_example/snake_example.html">Continuous Control (Snake)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unity_example/unity_example.html">Cross Platform Control (Unity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mouse_example/mouse_example.html">Proportional Control (Mouse Interface)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixed_reality_example/mixed_reality_example.html">Mixed Reality (Hololens 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitts_example.html">Online Evaluation (Iso Fitts)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">libemg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Methods</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/libemg/libemg/blob/main/docs/source/examples/fitts_example/fitts.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://github.com/libemg/LibEMG_Isofitts_Showcase">View Source Code</a></p>
<style>
    .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 50%;
    }
</style>
<p>For EMG-based control systems, it has been shown that the offline performance of a system (i.e., classification accuracy, mean absolute error) does not necessarily correlate to online usability. In this example, we introduce an Iso Fitts test for assessing the online performance of continuous EMG-based control systems.
Different types of models, such as regressors and classifiers, cannot be easily compared offline since different metrics are calculated. Online tests allow us to compare these distinct model types and assess a model’s ability to perform a task with a user in the loop.</p>
<section class="tex2jax_ignore mathjax_ignore" id="methods">
<h1>Methods<a class="headerlink" href="#methods" title="Permalink to this heading"></a></h1>
<p>This example acts as a mini experiment that you can try out on yourself or a friend where the offline and online performance of four popular classifiers (<strong>LDA, SVM, RF,</strong> and <strong>KNN (k=5</strong>)) and two regressors (<strong>LR and SVM</strong>) are compared.</p>
<p>The steps of this ‘mini experiment’ are as follows:</p>
<ol class="arabic simple">
<li><p><strong>Accumulate 3 repetitions of five contractions (no movement, flexion, extension, hand open, and hand closed).</strong> These classes correspond to movement in the isofitts task (do nothing,  and move left, right, up, and down).</p></li>
</ol>
<table>
  <tr>
    <td><img src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/menu.PNG?raw=true" alt="Image 1" width="1200"/></td>
    <td><img src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/training_screen1.png?raw=true" alt="Image 2" width="1200"/></td>
  </tr>
  <tr>
    <td><img src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/training_screen2.png?raw=true" alt="Image 3" width="1200"/></td>
    <td><img src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/training_screen3.png?raw=true" alt="Image 4" width="1200"/></td>
  </tr>
</table>
<ol class="arabic simple" start="2">
<li><p><strong>Train and evaluate four classifiers in an offline setting (LDA, SVM, KNN (k=5), and RF).</strong> For this step, the first 2 reps are used for training and the last for testing.</p></li>
<li><p><strong>Perform an Iso Fitts test to evaluate the online usability of each classifier trained in step 2.</strong> These fitts law tests are useful for computing throughput, overshoots, and efficiency. Ultimately, these metrics provide an indication of the online usability of a model. The Iso Fitts test is useful for myoelectric control systems as it requires changes in degrees of freedom to complete sucessfully.
<img alt="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/isofitts.PNG?raw=true" class="center" src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/isofitts.PNG?raw=true" /></p></li>
<li><p><strong>Repeat steps 1-3 using regressors instead of classifiers.</strong> Select ‘regression’ from the radio buttons and redo data collection. You will now be shown a video of a point moving through a cartesian plane, which indicates the position along each DOF. Follow the point in real-time to provide the regressor with continuously-labelled training data (as opposed to classes in classification). This video will be repeated 3 times (i.e., 3 repetitions). Note that you can now perform simultaneous contractions (i.e., move the cursor along the diagonal) when using a regressor.</p></li>
</ol>
<p><strong>Note:</strong> We have made this example to work with the <code class="docutils literal notranslate"><span class="pre">Myo</span> <span class="pre">Armband</span></code>. However, it can easily be used for any hardware by simply switching the <code class="docutils literal notranslate"><span class="pre">streamer</span></code>, <code class="docutils literal notranslate"><span class="pre">WINDOW_SIZE</span></code>, and <code class="docutils literal notranslate"><span class="pre">WINDOW_INCREMENT</span></code>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="menu">
<h1>Menu<a class="headerlink" href="#menu" title="Permalink to this heading"></a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">libemg.streamers</span><span class="w"> </span><span class="kn">import</span> <span class="n">myo_streamer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.gui</span><span class="w"> </span><span class="kn">import</span> <span class="n">GUI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.data_handler</span><span class="w"> </span><span class="kn">import</span> <span class="n">OnlineDataHandler</span><span class="p">,</span> <span class="n">OfflineDataHandler</span><span class="p">,</span> <span class="n">RegexFilter</span><span class="p">,</span> <span class="n">FilePackager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.feature_extractor</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureExtractor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.emg_predictor</span><span class="w"> </span><span class="kn">import</span> <span class="n">OnlineEMGClassifier</span><span class="p">,</span> <span class="n">EMGClassifier</span><span class="p">,</span> <span class="n">EMGRegressor</span><span class="p">,</span> <span class="n">OnlineEMGRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.environments.fitts</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISOFitts</span><span class="p">,</span> <span class="n">FittsConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.environments.controllers</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassifierController</span><span class="p">,</span> <span class="n">RegressorController</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libemg.animator</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScatterPlotAnimator</span>
</pre></div>
</div>
<p>Similarly to previous examples, we decided to create a simple menu to (1) leverage the training module and (2) enable the use of different models. To do this, we have included two buttons in <code class="docutils literal notranslate"><span class="pre">menu.py</span></code>. When the “accumulate training data button” is clicked, we leverage the training UI module. For this example, we want 3 reps (2 training - 1 testing), and we point it to the “images” folder as it contains images for each class. To instead evaluate a regressor, simply select the ‘Regression’ radio button and collect the required data. Note that launching training for regression will create a <code class="docutils literal notranslate"><span class="pre">collection.mp4</span></code> file using the <code class="docutils literal notranslate"><span class="pre">Animator</span></code> class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">launch_training</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regression_selected</span><span class="p">():</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;media_folder&#39;</span><span class="p">:</span> <span class="s1">&#39;animation/&#39;</span><span class="p">,</span> <span class="s1">&#39;data_folder&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;regression&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span> <span class="s1">&#39;rep_time&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;media_folder&#39;</span><span class="p">:</span> <span class="s1">&#39;images/&#39;</span><span class="p">,</span> <span class="s1">&#39;data_folder&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()}</span>
    <span class="n">training_ui</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">gesture_height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gesture_width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">training_ui</span><span class="o">.</span><span class="n">download_gestures</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s2">&quot;images/&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_animation</span><span class="p">()</span>
    <span class="n">training_ui</span><span class="o">.</span><span class="n">start_gui</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_ui</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;animation&#39;</span><span class="p">,</span> <span class="s1">&#39;collection.mp4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">regression_selected</span><span class="p">()</span> <span class="ow">or</span> <span class="n">output_filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating regression training animation...&#39;</span><span class="p">)</span>
    <span class="n">period</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># period of sinusoid (seconds)</span>
    <span class="n">cycles</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">rest_time</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># (seconds)</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cycles</span> <span class="o">*</span> <span class="n">period</span> <span class="o">+</span> <span class="n">rest_time</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_duration</span> <span class="o">-</span> <span class="n">rest_time</span><span class="p">,</span> <span class="n">fps</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_duration</span> <span class="o">-</span> <span class="n">rest_time</span><span class="p">))</span>
    <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>    <span class="c1"># add sinusoids</span>
    <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fps</span> <span class="o">*</span> <span class="n">rest_time</span><span class="p">))</span>   <span class="c1"># add rest time</span>

    <span class="c1"># Convert into 2D (N x M) array with isolated sinusoids per DOF</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dof1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)))</span>
    <span class="n">dof2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">coordinates</span><span class="p">),</span> <span class="n">coordinates</span><span class="p">))</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dof1</span><span class="p">,</span> <span class="n">dof2</span><span class="p">))</span>
    
    <span class="n">axis_images</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;Hand_Open.png&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;Hand_Close.png&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;Wrist_Extension.png&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;Wrist_Flexion.png&#39;</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="n">animator</span> <span class="o">=</span> <span class="n">ScatterPlotAnimator</span><span class="p">(</span><span class="n">output_filepath</span><span class="o">=</span><span class="n">output_filepath</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span> <span class="n">show_direction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_countdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis_images</span><span class="o">=</span><span class="n">axis_images</span><span class="p">)</span>
    <span class="n">animator</span><span class="o">.</span><span class="n">save_plot_video</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Regression Training&#39;</span><span class="p">,</span> <span class="n">save_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The next button option involves starting the Iso Fitts task. This occurs after the training data has been recorded. We opted for 8 circles in this task, but this can be varied easily with the constructor. Note that in this step we create the online model and start the Fitts law test, so please ensure that you have changed the text box to select the desired model type. If you are performing classification, recommended options are ‘LDA’, ‘SVM’, ‘KNN’, and ‘RF’. If you are performing regression, recommended options are ‘LR’ and ‘RF’. To see a full list of available options for classifiers and regressors in <code class="docutils literal notranslate"><span class="pre">LibEMG</span></code>, check out the <code class="docutils literal notranslate"><span class="pre">EMGClassifier</span></code> and <code class="docutils literal notranslate"><span class="pre">EMGRegressor</span></code> in the <a class="reference external" href="https://github.com/LibEMG/libemg">source code</a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">start_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_up_model</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regression_selected</span><span class="p">():</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="n">RegressorController</span><span class="p">()</span>
        <span class="n">save_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_str</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_reg&#39;</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="n">ClassifierController</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">output_format</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">save_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_str</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_clf&#39;</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">FittsConfig</span><span class="p">(</span><span class="n">num_trials</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">save_file</span><span class="o">=</span><span class="n">save_file</span><span class="p">)</span>
    <span class="n">ISOFitts</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="c1"># Its important to stop the model after the game has ended</span>
    <span class="c1"># Otherwise it will continuously run in a seperate process</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stop_running</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_ui</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, let’s break this piece of code up. First, let’s explore the <code class="docutils literal notranslate"><span class="pre">self.set_up_model()</span></code> function call. This step involves parsing the offline training data using the <code class="docutils literal notranslate"><span class="pre">OfflineDataHandler</span></code>. The file format for this example is R_&lt;#&gt;<em>C</em>&lt;#&gt;.csv. So to extract the reps the left bound is <code class="docutils literal notranslate"><span class="pre">R_</span></code> and the right bound is <code class="docutils literal notranslate"><span class="pre">_C_</span></code>. Similarly, to extract the classes, the left bound is <code class="docutils literal notranslate"><span class="pre">C_</span></code> and the right bound is <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. Additionally, there are three training reps and five classes. For regression, the labels are extracted from a separate text file instead of from the filename. The <code class="docutils literal notranslate"><span class="pre">collection.txt</span></code> file is used to create the labels for each data file via a <code class="docutils literal notranslate"><span class="pre">FilePackager</span></code>. Once we extract all this information, we create the <code class="docutils literal notranslate"><span class="pre">OfflineDataHandler</span></code> and extract the <code class="docutils literal notranslate"><span class="pre">train_windows</span></code> and <code class="docutils literal notranslate"><span class="pre">train_metadata</span></code> variables.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Parse offline training data</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regression_selected</span><span class="p">():</span>
    <span class="n">regex_filters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span><span class="o">=</span><span class="s1">&#39;regression/C_0_R_&#39;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s1">&#39;_emg.csv&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;reps&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">metadata_fetchers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FilePackager</span><span class="p">(</span><span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span><span class="o">=</span><span class="s1">&#39;animation/&#39;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">),</span> <span class="n">package_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">labels_key</span> <span class="o">=</span> <span class="s1">&#39;labels&#39;</span>
    <span class="n">metadata_operations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="s1">&#39;last_sample&#39;</span><span class="p">}</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">regex_filters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;classification/C_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_R&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;classes&#39;</span><span class="p">),</span>
        <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;R_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_emg.csv&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;reps&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">metadata_fetchers</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">labels_key</span> <span class="o">=</span> <span class="s1">&#39;classes&#39;</span>
    <span class="n">metadata_operations</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">odh</span> <span class="o">=</span> <span class="n">OfflineDataHandler</span><span class="p">()</span>
<span class="n">odh</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">regex_filters</span><span class="p">,</span> <span class="n">metadata_fetchers</span><span class="o">=</span><span class="n">metadata_fetchers</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">train_windows</span><span class="p">,</span> <span class="n">train_metadata</span> <span class="o">=</span> <span class="n">odh</span><span class="o">.</span><span class="n">parse_windows</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="n">metadata_operations</span><span class="o">=</span><span class="n">metadata_operations</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step involves extracting features from the training data. To do this we leverage the <code class="docutils literal notranslate"><span class="pre">FeatureExtractor</span></code> module. In this example, we use the <code class="docutils literal notranslate"><span class="pre">Low</span> <span class="pre">Sampling</span> <span class="pre">4</span> <span class="pre">(LS4)</span></code> feature set as it is a robust group for low sampling rate devices such as the Myo.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 2: Extract features from offline data</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">FeatureExtractor</span><span class="p">()</span>
<span class="n">feature_list</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">get_feature_groups</span><span class="p">()[</span><span class="s1">&#39;LS4&#39;</span><span class="p">]</span>
<span class="n">training_features</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">feature_list</span><span class="p">,</span> <span class="n">train_windows</span><span class="p">)</span>
</pre></div>
</div>
<p>We then split the training features and labels into a dataset dictionary for the <code class="docutils literal notranslate"><span class="pre">OnlineEMGClassifier</span></code> module.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: Dataset creation</span>
<span class="n">data_set</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">training_features</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_metadata</span><span class="p">[</span><span class="n">labels_key</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, we create the offline and online models using the default options. Notice that when creating the model, we pass in the text from the menu text field. This enables the user to pass in <code class="docutils literal notranslate"><span class="pre">LDA</span></code>, <code class="docutils literal notranslate"><span class="pre">SVM</span></code>, etc. with ease. Once the model is created, the <code class="docutils literal notranslate"><span class="pre">.run()</span></code> function is called and predictions begin.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 4: Create the EMG model</span>
<span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_str</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regression_selected</span><span class="p">():</span>
    <span class="c1"># Regression</span>
    <span class="n">emg_model</span> <span class="o">=</span> <span class="n">EMGRegressor</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
    <span class="n">emg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_dictionary</span><span class="o">=</span><span class="n">data_set</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">OnlineEMGRegressor</span><span class="p">(</span><span class="n">emg_model</span><span class="p">,</span> <span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">feature_list</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Classification</span>
    <span class="n">emg_model</span> <span class="o">=</span> <span class="n">EMGClassifier</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
    <span class="n">emg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_dictionary</span><span class="o">=</span><span class="n">data_set</span><span class="p">)</span>
    <span class="n">emg_model</span><span class="o">.</span><span class="n">add_velocity</span><span class="p">(</span><span class="n">train_windows</span><span class="p">,</span> <span class="n">train_metadata</span><span class="p">[</span><span class="n">labels_key</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">OnlineEMGClassifier</span><span class="p">(</span><span class="n">emg_model</span><span class="p">,</span> <span class="n">WINDOW_SIZE</span><span class="p">,</span> <span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">odh</span><span class="p">,</span> <span class="n">feature_list</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;probabilities&#39;</span><span class="p">)</span>

<span class="c1"># Step 5: Create online EMG model and start predicting.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># block set to false so it will run in a seperate process.</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fitts-test">
<h1>Fitts Test<a class="headerlink" href="#fitts-test" title="Permalink to this heading"></a></h1>
<p>To create the Isofitts test, we leveraged <code class="docutils literal notranslate"><span class="pre">pygame</span></code>. The code for this module can be found in <code class="docutils literal notranslate"><span class="pre">libemg.environments.isofitts.py</span></code>.</p>
<p>To increase the speed of the cursor we could do one of two things: (1) increase the velocity of the cursor (i.e., how many pixels it moves for each prediction), or (2) decrease the increment so that more predictions are made in the same amount of time. Parameters like this can be modified by passing arguments to the <code class="docutils literal notranslate"><span class="pre">IsoFitts</span></code> constructor.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-analysis">
<h1>Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this heading"></a></h1>
<p>After accumulating data from the experiment, we need a way to analyze the data. In  <code class="docutils literal notranslate"><span class="pre">analyze_data.py</span></code>, we added the capability to evaluate each model’s offline and online performance.</p>
<p>To evaluate each model’s offline performance, we took a similar approach to set up the online model. However, in this case, we have to split up the data into training and testing. To do this, we first extract each of the 3 reps of data. We will split this into training and testing in a little bit.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">regex_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;classification/C_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_R&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;classes&#39;</span><span class="p">),</span>
    <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span> <span class="o">=</span> <span class="s2">&quot;R_&quot;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s2">&quot;_emg.csv&quot;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;reps&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">clf_odh</span> <span class="o">=</span> <span class="n">OfflineDataHandler</span><span class="p">()</span>
<span class="n">clf_odh</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;data/&#39;</span><span class="p">,</span> <span class="n">regex_filters</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="n">regex_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span><span class="o">=</span><span class="s1">&#39;data/regression/C_0_R_&#39;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s1">&#39;_emg.csv&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;reps&#39;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">metadata_fetchers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">FilePackager</span><span class="p">(</span><span class="n">RegexFilter</span><span class="p">(</span><span class="n">left_bound</span><span class="o">=</span><span class="s1">&#39;animation/&#39;</span><span class="p">,</span> <span class="n">right_bound</span><span class="o">=</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">),</span> <span class="n">package_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">reg_odh</span> <span class="o">=</span> <span class="n">OfflineDataHandler</span><span class="p">()</span>
<span class="n">reg_odh</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">regex_filters</span><span class="p">,</span> <span class="n">metadata_fetchers</span><span class="o">=</span><span class="n">metadata_fetchers</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">isolate_data</span></code> function, we can split the data into training and testing. In this specific case, we are splitting on the “reps” keyword and we want values with index 0-1 for training and 2 for testing. After isolating the data, we extract windows and associated metadata for both training and testing sets.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">train_odh</span> <span class="o">=</span> <span class="n">odh</span><span class="o">.</span><span class="n">isolate_data</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;reps&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">train_windows</span><span class="p">,</span> <span class="n">train_metadata</span> <span class="o">=</span> <span class="n">train_odh</span><span class="o">.</span><span class="n">parse_windows</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">,</span><span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="n">metadata_operations</span><span class="o">=</span><span class="n">metadata_operations</span><span class="p">)</span>
<span class="n">test_odh</span> <span class="o">=</span> <span class="n">odh</span><span class="o">.</span><span class="n">isolate_data</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;reps&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_windows</span><span class="p">,</span> <span class="n">test_metadata</span> <span class="o">=</span> <span class="n">test_odh</span><span class="o">.</span><span class="n">parse_windows</span><span class="p">(</span><span class="n">WINDOW_SIZE</span><span class="p">,</span><span class="n">WINDOW_INCREMENT</span><span class="p">,</span> <span class="n">metadata_operations</span><span class="o">=</span><span class="n">metadata_operations</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we create a dataset dictionary consisting of testing and training features and labels. This dictionary is passed into an <code class="docutils literal notranslate"><span class="pre">OfflineDataHandler</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">data_set</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;testing_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">extract_feature_group</span><span class="p">(</span><span class="s1">&#39;HTD&#39;</span><span class="p">,</span> <span class="n">test_windows</span><span class="p">)</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">extract_feature_group</span><span class="p">(</span><span class="s1">&#39;HTD&#39;</span><span class="p">,</span> <span class="n">train_windows</span><span class="p">)</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;testing_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_metadata</span><span class="p">[</span><span class="n">labels_key</span><span class="p">]</span>
<span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;training_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_metadata</span><span class="p">[</span><span class="n">labels_key</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, to extract the offline performance of each model, we leverage the <code class="docutils literal notranslate"><span class="pre">OfflineMetrics</span></code> module. We do this in a loop to easily evaluate a number of models. We append the metrics to a dictionary for future use.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">om</span> <span class="o">=</span> <span class="n">OfflineMetrics</span><span class="p">()</span>
<span class="c1"># Normal Case - Test all different models</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_regression</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">EMGRegressor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_set</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;testing_features&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">EMGClassifier</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_set</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">preds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;testing_features&#39;</span><span class="p">])</span>
    <span class="n">out_metrics</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">extract_offline_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;testing_labels&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">offline_metrics</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">offline_metrics</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_metrics</span><span class="p">)</span>
<span class="k">return</span> <span class="n">offline_metrics</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="results">
<h1>Results<a class="headerlink" href="#results" title="Permalink to this heading"></a></h1>
<p>There are clear discrepancies between offline and online metrics. For example, RF outperforms LDA in the offline classification analysis, but it is clear in the online test that it is much worse. Similarly, RF outperforms LR in the offline regression analysis, but the usability metrics again suggest that LR outperforms RF during an online task. This highlights the need to evaluate EMG-based control systems in online settings with user-in-the-loop feedback.</p>
<p>These results also show that regressors had worse usability metrics than classifiers despite enabling simultaneous motions. The high number of overshoots indicate that this is likely due to the fact that the model stuggled to stay at rest without drifting, increasing the time each trial took. This example could be expanded by adding things like a threshold to the regressors (see <code class="docutils literal notranslate"><span class="pre">EMGRegressor.add_deadband</span></code>), which may improve regressor performance.</p>
<p><strong>Visual Output:</strong>
<img alt="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/perf_metrics.PNG?raw=true" src="https://github.com/libemg/LibEMG_Isofitts_Showcase/blob/main/docs/perf_metrics.PNG?raw=true" /></p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>